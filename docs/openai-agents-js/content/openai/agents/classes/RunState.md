---
editUrl: false
next: false
prev: false
title: "RunState"
---

Serializable snapshot of an agent's run, including context, usage and trace.
While this class has publicly writable properties (prefixed with `_`), they are not meant to be
used directly. To read these properties, use the `RunResult` instead.

Manipulation of the state directly can lead to unexpected behavior and should be avoided.
Instead, use the `approve` and `reject` methods to interact with the state.

## Type Parameters

<table>
<thead>
<tr>
<th>Type Parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`TContext`

</td>
</tr>
<tr>
<td>

`TAgent` *extends* [`Agent`](/openai-agents-js/openai/agents/classes/agent/)\<`any`, `any`\>

</td>
</tr>
</tbody>
</table>

## Constructors

### Constructor

```ts
new RunState<TContext, TAgent>(
   context, 
   originalInput, 
   startingAgent, 
maxTurns): RunState<TContext, TAgent>
```

#### Parameters

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`context`

</td>
<td>

[`RunContext`](/openai-agents-js/openai/agents/classes/runcontext/)\<`TContext`\>

</td>
</tr>
<tr>
<td>

`originalInput`

</td>
<td>

 \| `string` \| [`AgentInputItem`](/openai-agents-js/openai/agents/type-aliases/agentinputitem/)[]

</td>
</tr>
<tr>
<td>

`startingAgent`

</td>
<td>

`TAgent`

</td>
</tr>
<tr>
<td>

`maxTurns`

</td>
<td>

`number`

</td>
</tr>
</tbody>
</table>

#### Returns

`RunState`\<`TContext`, `TAgent`\>

## Properties

### \_context

```ts
_context: RunContext<TContext>;
```

Run context tracking approvals, usage, and other metadata.

***

### \_currentAgent

```ts
_currentAgent: TAgent;
```

The agent currently handling the conversation.

***

### \_currentAgentSpan

```ts
_currentAgentSpan: 
  | undefined
| Span<AgentSpanData>;
```

Active tracing span for the current agent if tracing is enabled.

***

### \_currentStep

```ts
_currentStep: 
  | undefined
  | {
  newAgent: any;
  type: "next_step_handoff";
 }
  | {
  output: string;
  type: "next_step_final_output";
 }
  | {
  type: "next_step_run_again";
 }
  | {
  data: Record<string, any>;
  type: "next_step_interruption";
};
```

Next step computed for the agent to take.

***

### \_currentTurn

```ts
_currentTurn: number;
```

Current turn number in the conversation.

***

### \_generatedItems

```ts
_generatedItems: RunItem[];
```

Items generated by the agent during the run.

***

### \_inputGuardrailResults

```ts
_inputGuardrailResults: InputGuardrailResult[];
```

Results from input guardrails applied to the run.

***

### \_lastProcessedResponse

```ts
_lastProcessedResponse: undefined | ProcessedResponse<TContext>;
```

Parsed model response after applying guardrails and tools.

***

### \_lastTurnResponse

```ts
_lastTurnResponse: 
  | undefined
  | ModelResponse;
```

Last model response for the previous turn.

***

### \_maxTurns

```ts
_maxTurns: number;
```

Maximum allowed turns before forcing termination.

***

### \_modelResponses

```ts
_modelResponses: ModelResponse[];
```

Responses from the model so far.

***

### \_noActiveAgentRun

```ts
_noActiveAgentRun: boolean;
```

Whether the run has an active agent step in progress.

***

### \_originalInput

```ts
_originalInput: 
  | string
  | AgentInputItem[];
```

Original user input prior to any processing.

***

### \_outputGuardrailResults

```ts
_outputGuardrailResults: OutputGuardrailResult<OutputGuardrailMetadata, "text">[];
```

Results from output guardrails applied to the run.

***

### \_toolUseTracker

```ts
_toolUseTracker: AgentToolUseTracker;
```

Tracks what tools each agent has used.

***

### \_trace

```ts
_trace: null | Trace;
```

Trace associated with this run if tracing is enabled.

## Methods

### approve()

```ts
approve(approvalItem, options?): void
```

Approves a tool call requested by the agent through an interruption and approval item request.

To approve the request use this method and then run the agent again with the same state object
to continue the execution.

By default it will only approve the current tool call. To allow the tool to be used multiple
times throughout the run, set the `alwaysApprove` option to `true`.

#### Parameters

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`approvalItem`

</td>
<td>

[`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem/)

</td>
<td>

The tool call approval item to approve.

</td>
</tr>
<tr>
<td>

`options`?

</td>
<td>

\{ `alwaysApprove`: `boolean`; \}

</td>
<td>

Options for the approval.

</td>
</tr>
<tr>
<td>

`options.alwaysApprove`?

</td>
<td>

`boolean`

</td>
<td>

&hyphen;

</td>
</tr>
</tbody>
</table>

#### Returns

`void`

***

### reject()

```ts
reject(approvalItem, options?): void
```

Rejects a tool call requested by the agent through an interruption and approval item request.

To reject the request use this method and then run the agent again with the same state object
to continue the execution.

By default it will only reject the current tool call. To allow the tool to be used multiple
times throughout the run, set the `alwaysReject` option to `true`.

#### Parameters

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`approvalItem`

</td>
<td>

[`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem/)

</td>
<td>

The tool call approval item to reject.

</td>
</tr>
<tr>
<td>

`options`?

</td>
<td>

\{ `alwaysReject`: `boolean`; \}

</td>
<td>

Options for the rejection.

</td>
</tr>
<tr>
<td>

`options.alwaysReject`?

</td>
<td>

`boolean`

</td>
<td>

&hyphen;

</td>
</tr>
</tbody>
</table>

#### Returns

`void`

***

### toJSON()

```ts
toJSON(): object
```

Serializes the run state to a JSON object.

This method is used to serialize the run state to a JSON object that can be used to
resume the run later.

#### Returns

`object`

The serialized run state.

##### $schemaVersion

```ts
$schemaVersion: "1.0";
```

##### context

```ts
context: object;
```

###### context.approvals

```ts
approvals: Record<string, {
  approved: boolean | string[];
  rejected: boolean | string[];
}>;
```

###### context.context

```ts
context: Record<string, any>;
```

###### context.usage

```ts
usage: object;
```

###### context.usage.inputTokens

```ts
inputTokens: number;
```

###### context.usage.outputTokens

```ts
outputTokens: number;
```

###### context.usage.requests

```ts
requests: number;
```

###### context.usage.totalTokens

```ts
totalTokens: number;
```

##### currentAgent

```ts
currentAgent: object;
```

###### currentAgent.name

```ts
name: string;
```

##### currentAgentSpan?

```ts
optional currentAgentSpan: null | SerializedSpanType;
```

##### currentStep?

```ts
optional currentStep: 
  | {
  newAgent: any;
  type: "next_step_handoff";
 }
  | {
  output: string;
  type: "next_step_final_output";
 }
  | {
  type: "next_step_run_again";
 }
  | {
  data: Record<string, any>;
  type: "next_step_interruption";
};
```

##### currentTurn

```ts
currentTurn: number;
```

##### generatedItems

```ts
generatedItems: (
  | {
  agent: {
     name: string;
    };
  rawItem: {
     content: (
        | {
        providerData: Record<string, any>;
        refusal: string;
        type: "refusal";
       }
        | {
        providerData: Record<string, any>;
        text: string;
        type: "output_text";
       }
        | {
        providerData: Record<string, any>;
        text: string;
        type: "input_text";
       }
        | {
        audio:   | string
           | {
           id: string;
          };
        format: null | string;
        providerData: Record<string, any>;
        transcript: null | string;
        type: "audio";
       }
        | {
        image: string;
        providerData: Record<string, any>;
        type: "image";
       })[];
     id: string;
     providerData: Record<string, any>;
     role: "assistant";
     status: "in_progress" | "completed" | "incomplete";
     type: "message";
    };
  type: "message_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem:   | {
     id: string;
     name: string;
     output: string;
     providerData: Record<string, any>;
     status: string;
     type: "hosted_tool_call";
    }
     | {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    }
     | {
     action:   | {
        type: "screenshot";
       }
        | {
        button: "left" | "right" | "wheel" | "back" | "forward";
        type: "click";
        x: number;
        y: number;
       }
        | {
        type: "double_click";
        x: number;
        y: number;
       }
        | {
        scroll_x: number;
        scroll_y: number;
        type: "scroll";
        x: number;
        y: number;
       }
        | {
        text: string;
        type: "type";
       }
        | {
        type: "wait";
       }
        | {
        type: "move";
        x: number;
        y: number;
       }
        | {
        keys: string[];
        type: "keypress";
       }
        | {
        path: object[];
        type: "drag";
       };
     callId: string;
     id: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "computer_call";
    };
  type: "tool_call_item";
 }
  | {
  agent: {
     name: string;
    };
  output: string;
  rawItem: {
     callId: string;
     id: string;
     name: string;
     output:   | {
        providerData: Record<string, any>;
        text: string;
        type: "text";
       }
        | {
        data: string;
        mediaType: string;
        providerData: Record<string, any>;
        type: "image";
       };
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call_result";
    };
  type: "tool_call_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     content: object[];
     id: string;
     providerData: Record<string, any>;
     type: "reasoning";
    };
  type: "reasoning_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    };
  type: "handoff_call_item";
 }
  | {
  rawItem: {
     callId: string;
     id: string;
     name: string;
     output:   | {
        providerData: Record<string, any>;
        text: string;
        type: "text";
       }
        | {
        data: string;
        mediaType: string;
        providerData: Record<string, any>;
        type: "image";
       };
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call_result";
    };
  sourceAgent: {
     name: string;
    };
  targetAgent: {
     name: string;
    };
  type: "handoff_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    };
  type: "tool_approval_item";
 })[];
```

##### inputGuardrailResults

```ts
inputGuardrailResults: object[];
```

##### lastModelResponse?

```ts
optional lastModelResponse: object;
```

###### lastModelResponse.output

```ts
output: (
  | {
  content: (
     | {
     providerData: Record<..., ...>;
     refusal: string;
     type: "refusal";
    }
     | {
     providerData: Record<..., ...>;
     text: string;
     type: "output_text";
    }
     | {
     providerData: Record<..., ...>;
     text: string;
     type: "input_text";
    }
     | {
     audio:   | string
        | {
        id: ...;
       };
     format: null | string;
     providerData: Record<..., ...>;
     transcript: null | string;
     type: "audio";
    }
     | {
     image: string;
     providerData: Record<..., ...>;
     type: "image";
    })[];
  id: string;
  providerData: Record<string, any>;
  role: "assistant";
  status: "in_progress" | "completed" | "incomplete";
  type: "message";
 }
  | {
  id: string;
  name: string;
  output: string;
  providerData: Record<string, any>;
  status: string;
  type: "hosted_tool_call";
 }
  | {
  arguments: string;
  callId: string;
  id: string;
  name: string;
  providerData: Record<string, any>;
  status: "in_progress" | "completed" | "incomplete";
  type: "function_call";
 }
  | {
  action:   | {
     type: "screenshot";
    }
     | {
     button: "left" | "right" | "wheel" | "back" | "forward";
     type: "click";
     x: number;
     y: number;
    }
     | {
     type: "double_click";
     x: number;
     y: number;
    }
     | {
     scroll_x: number;
     scroll_y: number;
     type: "scroll";
     x: number;
     y: number;
    }
     | {
     text: string;
     type: "type";
    }
     | {
     type: "wait";
    }
     | {
     type: "move";
     x: number;
     y: number;
    }
     | {
     keys: string[];
     type: "keypress";
    }
     | {
     path: object[];
     type: "drag";
    };
  callId: string;
  id: string;
  providerData: Record<string, any>;
  status: "in_progress" | "completed" | "incomplete";
  type: "computer_call";
 }
  | {
  content: object[];
  id: string;
  providerData: Record<string, any>;
  type: "reasoning";
 }
  | {
  id: string;
  providerData: Record<string, any>;
  type: "unknown";
 })[];
```

###### lastModelResponse.responseId?

```ts
optional responseId: string;
```

###### lastModelResponse.usage

```ts
usage: object;
```

###### lastModelResponse.usage.inputTokens

```ts
inputTokens: number;
```

###### lastModelResponse.usage.outputTokens

```ts
outputTokens: number;
```

###### lastModelResponse.usage.requests

```ts
requests: number;
```

###### lastModelResponse.usage.totalTokens

```ts
totalTokens: number;
```

##### lastProcessedResponse?

```ts
optional lastProcessedResponse: object;
```

###### lastProcessedResponse.computerActions

```ts
computerActions: object[];
```

###### lastProcessedResponse.functions

```ts
functions: object[];
```

###### lastProcessedResponse.handoffs

```ts
handoffs: object[];
```

###### lastProcessedResponse.newItems

```ts
newItems: (
  | {
  agent: {
     name: string;
    };
  rawItem: {
     content: (
        | {
        providerData: ... | ...;
        refusal: string;
        type: "refusal";
       }
        | {
        providerData: ... | ...;
        text: string;
        type: "output_text";
       }
        | {
        providerData: ... | ...;
        text: string;
        type: "input_text";
       }
        | {
        audio: ... | ...;
        format: ... | ... | ...;
        providerData: ... | ...;
        transcript: ... | ... | ...;
        type: "audio";
       }
        | {
        image: string;
        providerData: ... | ...;
        type: "image";
       })[];
     id: string;
     providerData: Record<string, any>;
     role: "assistant";
     status: "in_progress" | "completed" | "incomplete";
     type: "message";
    };
  type: "message_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem:   | {
     id: string;
     name: string;
     output: string;
     providerData: Record<string, any>;
     status: string;
     type: "hosted_tool_call";
    }
     | {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    }
     | {
     action:   | {
        type: "screenshot";
       }
        | {
        button: ... | ... | ... | ... | ...;
        type: "click";
        x: number;
        y: number;
       }
        | {
        type: "double_click";
        x: number;
        y: number;
       }
        | {
        scroll_x: number;
        scroll_y: number;
        type: "scroll";
        x: number;
        y: number;
       }
        | {
        text: string;
        type: "type";
       }
        | {
        type: "wait";
       }
        | {
        type: "move";
        x: number;
        y: number;
       }
        | {
        keys: ...[];
        type: "keypress";
       }
        | {
        path: ...[];
        type: "drag";
       };
     callId: string;
     id: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "computer_call";
    };
  type: "tool_call_item";
 }
  | {
  agent: {
     name: string;
    };
  output: string;
  rawItem: {
     callId: string;
     id: string;
     name: string;
     output:   | {
        providerData: Record<..., ...>;
        text: string;
        type: "text";
       }
        | {
        data: string;
        mediaType: string;
        providerData: Record<..., ...>;
        type: "image";
       };
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call_result";
    };
  type: "tool_call_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     content: object[];
     id: string;
     providerData: Record<string, any>;
     type: "reasoning";
    };
  type: "reasoning_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    };
  type: "handoff_call_item";
 }
  | {
  rawItem: {
     callId: string;
     id: string;
     name: string;
     output:   | {
        providerData: Record<..., ...>;
        text: string;
        type: "text";
       }
        | {
        data: string;
        mediaType: string;
        providerData: Record<..., ...>;
        type: "image";
       };
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call_result";
    };
  sourceAgent: {
     name: string;
    };
  targetAgent: {
     name: string;
    };
  type: "handoff_output_item";
 }
  | {
  agent: {
     name: string;
    };
  rawItem: {
     arguments: string;
     callId: string;
     id: string;
     name: string;
     providerData: Record<string, any>;
     status: "in_progress" | "completed" | "incomplete";
     type: "function_call";
    };
  type: "tool_approval_item";
 })[];
```

###### lastProcessedResponse.toolsUsed

```ts
toolsUsed: string[];
```

##### maxTurns

```ts
maxTurns: number;
```

##### modelResponses

```ts
modelResponses: object[];
```

##### noActiveAgentRun

```ts
noActiveAgentRun: boolean;
```

##### originalInput

```ts
originalInput: 
  | string
  | (
  | {
  content: (
     | {
     providerData: Record<string, any>;
     refusal: string;
     type: "refusal";
    }
     | {
     providerData: Record<string, any>;
     text: string;
     type: "output_text";
    }
     | {
     providerData: Record<string, any>;
     text: string;
     type: "input_text";
    }
     | {
     audio:   | string
        | {
        id: string;
       };
     format: null | string;
     providerData: Record<string, any>;
     transcript: null | string;
     type: "audio";
    }
     | {
     image: string;
     providerData: Record<string, any>;
     type: "image";
    })[];
  id: string;
  providerData: Record<string, any>;
  role: "assistant";
  status: "in_progress" | "completed" | "incomplete";
  type: "message";
 }
  | {
  content:   | string
     | (
     | {
     providerData: Record<..., ...>;
     text: string;
     type: "input_text";
    }
     | {
     image:   | string
        | {
        id: ...;
       };
     providerData: Record<..., ...>;
     type: "input_image";
    }
     | {
     file:   | string
        | {
        id: ...;
       };
     providerData: Record<..., ...>;
     type: "input_file";
    }
     | {
     audio:   | string
        | {
        id: ...;
       };
     format: null | string;
     providerData: Record<..., ...>;
     transcript: null | string;
     type: "audio";
    })[];
  id: string;
  providerData: Record<string, any>;
  role: "user";
  type: "message";
 }
  | {
  content: string;
  id: string;
  providerData: Record<string, any>;
  role: "system";
  type: "message";
 }
  | {
  id: string;
  name: string;
  output: string;
  providerData: Record<string, any>;
  status: string;
  type: "hosted_tool_call";
 }
  | {
  arguments: string;
  callId: string;
  id: string;
  name: string;
  providerData: Record<string, any>;
  status: "in_progress" | "completed" | "incomplete";
  type: "function_call";
 }
  | {
  callId: string;
  id: string;
  name: string;
  output:   | {
     providerData: Record<string, any>;
     text: string;
     type: "text";
    }
     | {
     data: string;
     mediaType: string;
     providerData: Record<string, any>;
     type: "image";
    };
  providerData: Record<string, any>;
  status: "in_progress" | "completed" | "incomplete";
  type: "function_call_result";
 }
  | {
  action:   | {
     type: "screenshot";
    }
     | {
     button: "left" | "right" | "wheel" | "back" | "forward";
     type: "click";
     x: number;
     y: number;
    }
     | {
     type: "double_click";
     x: number;
     y: number;
    }
     | {
     scroll_x: number;
     scroll_y: number;
     type: "scroll";
     x: number;
     y: number;
    }
     | {
     text: string;
     type: "type";
    }
     | {
     type: "wait";
    }
     | {
     type: "move";
     x: number;
     y: number;
    }
     | {
     keys: string[];
     type: "keypress";
    }
     | {
     path: object[];
     type: "drag";
    };
  callId: string;
  id: string;
  providerData: Record<string, any>;
  status: "in_progress" | "completed" | "incomplete";
  type: "computer_call";
 }
  | {
  callId: string;
  id: string;
  output: {
     data: string;
     providerData: Record<string, any>;
     type: "computer_screenshot";
    };
  providerData: Record<string, any>;
  type: "computer_call_result";
 }
  | {
  content: object[];
  id: string;
  providerData: Record<string, any>;
  type: "reasoning";
 }
  | {
  id: string;
  providerData: Record<string, any>;
  type: "unknown";
 })[];
```

##### outputGuardrailResults

```ts
outputGuardrailResults: object[];
```

##### toolUseTracker

```ts
toolUseTracker: Record<string, string[]>;
```

##### trace

```ts
trace: 
  | null
  | {
  group_id: null | string;
  id: string;
  metadata: Record<string, any>;
  object: "trace";
  workflow_name: string;
};
```

***

### toString()

```ts
toString(): string
```

Serializes the run state to a string.

This method is used to serialize the run state to a string that can be used to
resume the run later.

#### Returns

`string`

The serialized run state.

***

### fromString()

```ts
static fromString<TContext, TAgent>(initialAgent, str): Promise<RunState<TContext, TAgent>>
```

Deserializes a run state from a string.

This method is used to deserialize a run state from a string that was serialized using the
`toString` method.

#### Type Parameters

<table>
<thead>
<tr>
<th>Type Parameter</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`TContext`

</td>
</tr>
<tr>
<td>

`TAgent` *extends* [`Agent`](/openai-agents-js/openai/agents/classes/agent/)\<`any`, `any`\>

</td>
</tr>
</tbody>
</table>

#### Parameters

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>

`initialAgent`

</td>
<td>

`TAgent`

</td>
</tr>
<tr>
<td>

`str`

</td>
<td>

`string`

</td>
</tr>
</tbody>
</table>

#### Returns

`Promise`\<`RunState`\<`TContext`, `TAgent`\>\>
